![img](/202310/20231000-card.webp)

Amazonとマッチングアプリに課金しすぎている点を反省。
水族館が意外と重いが文化的な生活への投資として許せる。

|日付▼|名前|金額|日付|名前|金額▼|
|:---|:---:|---:|:---|:---:|---:|
|2023/09/01|ライフ川端東一条店|1011|2023/09/01|GOOGLE GOOGLE WALLET|15800|
|2023/09/01|AMAZON.CO.JP|1672|2023/08/04|JTBインターネット決済(AMARYS)(3/2)|11901|
|2023/09/01|ノート|1000|2023/06/08|GOTOGATE_JP_MATORZ (ONLINE )(6/4)|11355|
|2023/09/01|GOOGLE*CLOUD 2GKXQV|758|2023/09/30|TOEIC L&R 受験料|7810|
|2023/09/01|GOOGLE GOOGLE WALLET|15800|2023/09/15|ユニクロ|6990|
|2023/09/02|フレスコ五条大橋店|2126|2023/08/16|GOOGLE GOOGLE WALLET(3/2)|6732|
|2023/09/02|なか卯|990|2023/09/05|京都テラス*USEN|5000|
|2023/09/02|セブン-イレブン|1279|2023/09/16|京都水族館|4800|
|2023/09/03|KYOTO TOWER SANDO|840|2023/09/07|GMOとくとくBB|4688|
|2023/09/04|フレスコ五条大橋店|1612|2023/09/13|関西電力 電気|4293|
|2023/09/04|なか卯|840|2023/09/12|1691マツモトキヨシ京都タワーサンド店|4114|
|2023/09/04|AMAZON.CO.JP|499|2023/06/27|千里中央花ふさ皮ふ科(6/4)|3829|
|2023/09/04|AMAZON.CO.JP|1191|2023/09/17|AMAZON.CO.JP|3781|
|2023/09/04|AMAZON.CO.JP|880|2023/09/28|AMAZON.CO.JP|2955|
|2023/09/05|なか卯|790|2023/09/30|フレスコ五条大橋店|2923|
|2023/09/05|京都テラス*USEN|5000|2023/09/12|ポムの樹 京都ヨドバシ店/NFC|2420|
|2023/09/05|ドン・キホーテ四条河原町店|545|2023/09/09|AMAZON.CO.JP|2400|
|2023/09/05|アンスリー淀屋橋店|638|2023/09/12|フレスコ五条大橋店|2265|
|2023/09/06|フレスコ五条大橋店|1872|2023/09/14|京都水族館|2160|
|2023/09/07|セブン-イレブン|91|2023/09/02|フレスコ五条大橋店|2126|
|2023/09/07|GMOとくとくBB|4688|2023/09/08|ライフ川端東一条店|2091|
|2023/09/08|なか卯|860|2023/09/08|関西電力ガス|1956|
|2023/09/08|ライフ川端東一条店|2091|2023/09/27|1691マツモトキヨシ京都タワーサンド店|1900|
|2023/09/08|関西電力ガス|1956|2023/09/17|フレスコ五条大橋店|1896|
|2023/09/08|ラクテンペイ サラサカユウコウジ|1580|2023/09/13|ライフ川端東一条店|1884|
|2023/09/09|フレスコ五条大橋店|1861|2023/09/06|フレスコ五条大橋店|1872|
|2023/09/09|AMAZON.CO.JP|2400|2023/09/09|フレスコ五条大橋店|1861|
|2023/09/11|フレスコ五条大橋店|1565|2023/09/15|フレスコ五条大橋店|1805|
|2023/09/11|なか卯|1160|2023/09/01|AMAZON.CO.JP|1672|
|2023/09/11|AMAZON.CO.JP|469|2023/09/04|フレスコ五条大橋店|1612|
|2023/09/11|AMAZON.CO.JP|1399|2023/09/16|京都水族館|1600|
|2023/09/12|フレスコ五条大橋店|2265|2023/09/08|ラクテンペイ サラサカユウコウジ|1580|
|2023/09/12|ポムの樹 京都ヨドバシ店/NFC|2420|2023/09/11|フレスコ五条大橋店|1565|
|2023/09/12|ローソン|270|2023/09/11|AMAZON.CO.JP|1399|
|2023/09/12|1691マツモトキヨシ京都タワーサンド店|4114|2023/09/23|GOOGLE PLAY JAPAN|1280|
|2023/09/13|ライフ川端東一条店|1884|2023/09/02|セブン-イレブン|1279|
|2023/09/13|AMAZON.CO.JP|800|2023/09/14|フレスコ五条大橋店|1254|
|2023/09/13|関西電力 電気|4293|2023/09/04|AMAZON.CO.JP|1191|
|2023/09/14|フレスコ五条大橋店|1254|2023/09/11|なか卯|1160|
|2023/09/14|なか卯|950|2023/09/16|フレスコ五条大橋店|1060|
|2023/09/14|京都水族館|1040|2023/09/14|京都水族館|1040|
|2023/09/14|京都水族館|2160|2023/09/30|なか卯|1020|
|2023/09/15|フレスコ五条大橋店|1805|2023/09/01|ライフ川端東一条店|1011|
|2023/09/15|ユニクロ|6990|2023/09/01|ノート|1000|
|2023/09/16|フレスコ五条大橋店|1060|2023/09/02|なか卯|990|
|2023/09/16|ファミリーマート|138|2023/09/27|なか卯|980|
|2023/09/16|京都水族館|940|2023/09/14|なか卯|950|
|2023/09/16|京都水族館|1600|2023/09/16|京都水族館|940|
|2023/09/16|京都水族館|4800|2023/09/28|なか卯|940|
|2023/09/17|フレスコ五条大橋店|1896|2023/09/27|フレスコ五条大橋店|892|
|2023/09/17|AMAZON.CO.JP|3781|2023/09/04|AMAZON.CO.JP|880|
|2023/09/23|GOOGLE PLAY JAPAN|1280|2023/09/08|なか卯|860|
|2023/09/27|フレスコ五条大橋店|892|2023/09/03|KYOTO TOWER SANDO|840|
|2023/09/27|なか卯|980|2023/09/04|なか卯|840|
|2023/09/27|1691マツモトキヨシ京都タワーサンド店|1900|2023/09/13|AMAZON.CO.JP|800|
|2023/09/27|GOOGLE ANDYMENTE|180|2023/09/05|なか卯|790|
|2023/09/28|なか卯|940|2023/09/01|GOOGLE*CLOUD 2GKXQV|758|
|2023/09/28|AMAZON.CO.JP|2955|2023/09/05|アンスリー淀屋橋店|638|
|2023/09/30|フレスコ五条大橋店|2923|2023/09/05|ドン・キホーテ四条河原町店|545|
|2023/09/30|なか卯|1020|2023/09/04|AMAZON.CO.JP|499|
|2023/09/30|TOEIC L&R 受験料|7810|2023/09/11|AMAZON.CO.JP|469|
|2023/06/27|千里中央花ふさ皮ふ科(6/4)|3829|2023/09/12|ローソン|270|
|2023/08/04|JTBインターネット決済(AMARYS)(3/2)|11901|2023/09/27|GOOGLE ANDYMENTE|180|
|2023/08/16|GOOGLE GOOGLE WALLET(3/2)|6732|2023/09/16|ファミリーマート|138|
|2023/06/08|GOTOGATE_JP_MATORZ (ONLINE )(6/4)|11355|2023/09/07|セブン-イレブン|91|

`20231015-カード明細解析.py`

```python
#!python
import sys
from datetime import datetime
import unicodedata
import os
from matplotlib import pyplot as plt
from collections import OrderedDict
import itertools


def load(path: str):
    items = []
    with open(path, "rt", encoding="cp932") as f:
        for i in f:
            x = unicodedata.normalize('NFKC', i).strip().split(",")
            if x[0].count("/") != 2:
                continue
            year, month, day = x[0].split("/")
            x[0] = datetime(year=int(year), month=int(month), day=int(day))
            items.append(x)
    return items, os.path.basename(path).replace(".csv","")


def plot(items, name):
    fig = plt.figure(figsize=(10, 8))
    ax1 = fig.add_subplot(211)

    amount=sum([int(i[5]) for i in items])

    pie_data = {}
    pie_label = {}
    for i in items:
        k = i[1][:4]
        pie_data.setdefault(k, 0)
        pie_data[k] += int(i[5])
        pie_label[k] = i[1]
    pie_array = OrderedDict(sorted(pie_data.items(), key=lambda x: x[1]))
    pct=lambda x:"{}円".format(int(x*amount/100))
    ax1.pie(pie_array.values(), labels=[pie_label[k] for k in pie_array.keys()], autopct=pct)
    ax1.text(0, 0, "{}円".format(amount), ha='center', va='center', c="w")
    ax2 = fig.add_subplot(212)
    plot_items = list(filter(lambda x: int(x[3]) == 1, items))
    plot_items_accumulate=list(itertools.accumulate(int(i[5]) for i in plot_items))
    print(plot_items)
    ax2.plot([i[0] for i in plot_items], list(int(i[5]) for i in plot_items))
    ax2.plot([i[0] for i in plot_items], plot_items_accumulate)
    for i,y in zip(items,plot_items_accumulate):
        ax2.text(i[0],y,i[1],va="center",ha="left")
    fig.tight_layout()
    fig.savefig("{}00-card.webp".format(name))

def markdown(items,name):
    print("""
|日付▼|名前|金額|日付|名前|金額▼|
|:---|:---:|---:|:---|:---:|---:|""")
    def print_item(i):
        return [
            i[0].strftime('%Y/%m/%d'),
            i[1]+("" if int(i[3])==1 else "({}/{})".format(i[3],i[4])),
            i[5]
        ]
    for i1,i2 in zip(items,sorted(items, key=lambda x: -int(x[5]))):
        print("|".join([""]+print_item(i1)+print_item(i2)+[""]))

def default_plot(count):
    plt.rcParams['font.family'] = 'MS Mincho'
    plt.rcParams["font.size"] = 9
    if count == 1:
        plt.rcParams["figure.figsize"] = (8, 6)
    if count >= 4:
        plt.rcParams["figure.figsize"] = (6, 5)
    if count >= 10:
        plt.rcParams["figure.figsize"] = (6, 3.5)


if __name__ == "__main__":
    default_plot(1)
    items, name = load(sys.argv[1])
    plot(items, name)
    markdown(items, name)
```